legend.key.width = unit(0.5, "cm"),
legend.title = element_text(face = "bold", size = 11, vjust = 0.8),
legend.text = element_text(size = 10, color = "black"),
# 标题
plot.title = element_text(face = "bold", size = 16, hjust = 0.5,
margin = margin(b = 15)),
plot.subtitle = element_text(size = 12, hjust = 0.5, color = "gray40",
margin = margin(b = 10)),
# 边距
plot.margin = margin(20, 20, 20, 20)
) +
# 标签
labs(
title = "Ecological distribution"
)
print(p1)
ggsave("heatmap_dots.pdf", p1, width = 9, height = 12, dpi = 300, bg = "white")
# ==================== 1. 加载包 ====================
required_packages <- c("tidyverse", "ggplot2", "viridis", "RColorBrewer", "scales")
new_packages <- required_packages[!required_packages %in% installed.packages()[,"Package"]]
if(length(new_packages)) install.packages(new_packages)
library(tidyverse)
library(ggplot2)
library(viridis)
library(RColorBrewer)
library(scales)
# ==================== 2. 数据准备 ====================
data <- read.csv("Heatmap_data.csv", stringsAsFactors = FALSE)
# 数据处理 - 保留Total
heatmap_data <- data %>%
mutate(
# 注意：你的Percentage列已经是百分比（0-100），不需要转换
Percent = Percentage,  # 直接使用原值
# 定义基因型顺序（Total在最前面）
Genotype = factor(Type,
levels = c("Total", "A/H53", "B1/H24", "B2/H24R",
"B3/H24Rx", "B4/H24RxC", "B5/H24RxC")),
# 定义宿主顺序（按Total比例从高到低排序）
Host = factor(Host)
)
# 为了按Total比例排序宿主，先计算Total行
total_order <- heatmap_data %>%
filter(Type == "Total") %>%
arrange(desc(Percent)) %>%
pull(Host)
# 重新排序宿主因子
heatmap_data$Host <- factor(heatmap_data$Host, levels = total_order)
# 查看数据范围
cat("数据维度:", dim(heatmap_data), "\n")
cat("基因型:", levels(heatmap_data$Type), "\n")
cat("宿主数量:", length(levels(heatmap_data$Host)), "\n")
cat("百分比范围:", sprintf("%.2f%% 到 %.2f%%",
min(heatmap_data$Percent, na.rm = TRUE),
max(heatmap_data$Percent, na.rm = TRUE)), "\n\n")
# ==================== 3. 创建圆形热力图（颜色代表数值，点大小统一） ====================
p1 <- ggplot(heatmap_data, aes(x = Type, y = Host)) +
# 使用圆形，点大小统一，颜色编码百分比
geom_point(aes(color = Percent),
size = 9.5,  # 统一大小
shape = 19,
alpha = 0.85,
stroke = 0) +
# 只在圆形内部添加数值标签
geom_text(aes(label = ifelse(Percent >= 1,
sprintf("%.1f", Percent),
ifelse(Percent >= 0.1,
sprintf("%.1f", Percent),
ifelse(Percent > 0, "<0.1", "0.0")))),
color = "black",
size = 3.7) +
# 颜色渐变（viridis magma调色板）
scale_color_viridis(
option = "magma",
name = "(%)",
limits = c(0, 100),
direction = -1,  # 反向：高值亮色，低值暗色
begin = 0.1,     # 调整起始颜色
end = 0.95,      # 调整结束颜色
na.value = "gray85"
) +
# 主题设置
theme_minimal(base_size = 12) +
theme(
# 坐标轴文本
axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5,
face = "bold", size = 11, color = "black"),
axis.text.y = element_text(face = "bold", size = 11, color = "black"),
# 移除坐标轴标题
axis.title = element_blank(),
# 网格线
panel.grid.major = element_line(color = "gray93", size = 0.3),
panel.grid.minor = element_blank(),
# 图例
legend.position = "right",
legend.key.height = unit(1.8, "cm"),
legend.key.width = unit(0.5, "cm"),
legend.title = element_text(face = "bold", size = 11, vjust = 0.8),
legend.text = element_text(size = 10, color = "black"),
# 标题
plot.title = element_text(face = "bold", size = 16, hjust = 0.5,
margin = margin(b = 15)),
plot.subtitle = element_text(size = 12, hjust = 0.5, color = "gray40",
margin = margin(b = 10)),
# 边距
plot.margin = margin(20, 20, 20, 20)
) +
# 标签
labs(
title = "Ecological distribution"
)
print(p1)
ggsave("heatmap_dots.pdf", p1, width = 9, height = 12, dpi = 300, bg = "white")
# ==================== 1. 加载包 ====================
required_packages <- c("tidyverse", "ggplot2", "viridis", "RColorBrewer", "scales")
new_packages <- required_packages[!required_packages %in% installed.packages()[,"Package"]]
if(length(new_packages)) install.packages(new_packages)
library(tidyverse)
library(ggplot2)
library(viridis)
library(RColorBrewer)
library(scales)
# ==================== 2. 数据准备 ====================
data <- read.csv("Heatmap_data.csv", stringsAsFactors = FALSE)
# 数据处理 - 保留Total
heatmap_data <- data %>%
mutate(
# 注意：你的Percentage列已经是百分比（0-100），不需要转换
Percent = Percentage,  # 直接使用原值
# 定义基因型顺序（Total在最前面）
Genotype = factor(Type,
levels = c("Total", "A/H53", "B1/H24", "B2/H24R",
"B3/H24Rx", "B4/H24RxC", "B5/H24RxC")),
# 定义宿主顺序（按Total比例从高到低排序）
Host = factor(Host)
)
# 为了按Total比例排序宿主，先计算Total行
total_order <- heatmap_data %>%
filter(Type == "Total") %>%
arrange(desc(Percent)) %>%
pull(Host)
# 重新排序宿主因子
heatmap_data$Host <- factor(heatmap_data$Host, levels = total_order)
# 查看数据范围
cat("数据维度:", dim(heatmap_data), "\n")
cat("基因型:", levels(heatmap_data$Type), "\n")
cat("宿主数量:", length(levels(heatmap_data$Host)), "\n")
cat("百分比范围:", sprintf("%.2f%% 到 %.2f%%",
min(heatmap_data$Percent, na.rm = TRUE),
max(heatmap_data$Percent, na.rm = TRUE)), "\n\n")
# ==================== 3. 创建圆形热力图（颜色代表数值，点大小统一） ====================
p1 <- ggplot(heatmap_data, aes(x = Type, y = Host)) +
# 使用圆形，点大小统一，颜色编码百分比
geom_point(aes(color = Percent),
size = 9.5,  # 统一大小
shape = 19,
alpha = 0.85,
stroke = 0) +
# 只在圆形内部添加数值标签
geom_text(aes(label = ifelse(Percent >= 1,
sprintf("%.1f", Percent),
ifelse(Percent >= 0.1,
sprintf("%.1f", Percent),
ifelse(Percent > 0, "<0.1", "0.0")))),
color = "black",
size = 3.5) +
# 颜色渐变（viridis magma调色板）
scale_color_viridis(
option = "magma",
name = "(%)",
limits = c(0, 100),
direction = -1,  # 反向：高值亮色，低值暗色
begin = 0.1,     # 调整起始颜色
end = 0.95,      # 调整结束颜色
na.value = "gray85"
) +
# 主题设置
theme_minimal(base_size = 12) +
theme(
# 坐标轴文本
axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5,
face = "bold", size = 11, color = "black"),
axis.text.y = element_text(face = "bold", size = 11, color = "black"),
# 移除坐标轴标题
axis.title = element_blank(),
# 网格线
panel.grid.major = element_line(color = "gray93", size = 0.3),
panel.grid.minor = element_blank(),
# 图例
legend.position = "right",
legend.key.height = unit(1.8, "cm"),
legend.key.width = unit(0.5, "cm"),
legend.title = element_text(face = "bold", size = 11, vjust = 0.8),
legend.text = element_text(size = 10, color = "black"),
# 标题
plot.title = element_text(face = "bold", size = 16, hjust = 0.5,
margin = margin(b = 15)),
plot.subtitle = element_text(size = 12, hjust = 0.5, color = "gray40",
margin = margin(b = 10)),
# 边距
plot.margin = margin(20, 20, 20, 20)
) +
# 标签
labs(
title = "Ecological distribution"
)
print(p1)
ggsave("heatmap_dots.pdf", p1, width = 9, height = 12, dpi = 300, bg = "white")
# ==================== 1. 加载包 ====================
required_packages <- c("tidyverse", "ggplot2", "viridis", "RColorBrewer", "scales")
new_packages <- required_packages[!required_packages %in% installed.packages()[,"Package"]]
if(length(new_packages)) install.packages(new_packages)
library(tidyverse)
library(ggplot2)
library(viridis)
library(RColorBrewer)
library(scales)
# ==================== 2. 数据准备 ====================
data <- read.csv("Heatmap_data.csv", stringsAsFactors = FALSE)
# 数据处理 - 保留Total
heatmap_data <- data %>%
mutate(
# 注意：你的Percentage列已经是百分比（0-100），不需要转换
Percent = Percentage,  # 直接使用原值
# 定义基因型顺序（Total在最前面）
Genotype = factor(Type,
levels = c("Total", "A/H53", "B1/H24", "B2/H24R",
"B3/H24Rx", "B4/H24RxC", "B5/H24RxC")),
# 定义宿主顺序（按Total比例从高到低排序）
Host = factor(Host)
)
# 为了按Total比例排序宿主，先计算Total行
total_order <- heatmap_data %>%
filter(Type == "Total") %>%
arrange(desc(Percent)) %>%
pull(Host)
# 重新排序宿主因子
heatmap_data$Host <- factor(heatmap_data$Host, levels = total_order)
# 查看数据范围
cat("数据维度:", dim(heatmap_data), "\n")
cat("基因型:", levels(heatmap_data$Type), "\n")
cat("宿主数量:", length(levels(heatmap_data$Host)), "\n")
cat("百分比范围:", sprintf("%.2f%% 到 %.2f%%",
min(heatmap_data$Percent, na.rm = TRUE),
max(heatmap_data$Percent, na.rm = TRUE)), "\n\n")
# ==================== 3. 创建圆形热力图（颜色代表数值，点大小统一） ====================
p1 <- ggplot(heatmap_data, aes(x = Type, y = Host)) +
# 使用圆形，点大小统一，颜色编码百分比
geom_point(aes(color = Percent),
size = 9.5,  # 统一大小
shape = 19,
alpha = 0.85,
stroke = 0) +
# 只在圆形内部添加数值标签
geom_text(aes(label = ifelse(Percent >= 1,
sprintf("%.1f", Percent),
ifelse(Percent >= 0.1,
sprintf("%.1f", Percent),
ifelse(Percent > 0, "<0.1", "0.0")))),
color = "black",
size = 3.5) +
# 颜色渐变（viridis magma调色板）
scale_color_viridis(
option = "magma",
name = "(%)",
limits = c(0, 100),
direction = -1,  # 反向：高值亮色，低值暗色
begin = 0.1,     # 调整起始颜色
end = 0.95,      # 调整结束颜色
na.value = "gray85"
) +
# 主题设置
theme_minimal(base_size = 12) +
theme(
# 坐标轴文本
axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5, size = 11, color = "black"),
axis.text.y = element_text(size = 11, color = "black"),
# 移除坐标轴标题
axis.title = element_blank(),
# 网格线
panel.grid.major = element_line(color = "gray93", size = 0.3),
panel.grid.minor = element_blank(),
# 图例
legend.position = "right",
legend.key.height = unit(1.8, "cm"),
legend.key.width = unit(0.5, "cm"),
legend.title = element_text(face = "bold", size = 11, vjust = 0.8),
legend.text = element_text(size = 10, color = "black"),
# 标题
plot.title = element_text(face = "bold", size = 16, hjust = 0.5,
margin = margin(b = 15)),
plot.subtitle = element_text(size = 12, hjust = 0.5, color = "gray40",
margin = margin(b = 10)),
# 边距
plot.margin = margin(20, 20, 20, 20)
) +
# 标签
labs(
title = "Ecological distribution"
)
print(p1)
ggsave("heatmap_dots.pdf", p1, width = 9, height = 12, dpi = 300, bg = "white")
# ==================== 1. 加载包 ====================
required_packages <- c("tidyverse", "ggplot2", "viridis", "RColorBrewer", "scales")
new_packages <- required_packages[!required_packages %in% installed.packages()[,"Package"]]
if(length(new_packages)) install.packages(new_packages)
library(tidyverse)
library(ggplot2)
library(viridis)
library(RColorBrewer)
library(scales)
# ==================== 2. 数据准备 ====================
data <- read.csv("Heatmap_data.csv", stringsAsFactors = FALSE)
# 数据处理 - 保留Total
heatmap_data <- data %>%
mutate(
# 注意：你的Percentage列已经是百分比（0-100），不需要转换
Percent = Percentage,  # 直接使用原值
# 定义基因型顺序（Total在最前面）
Type = factor(Type,
levels = c("Total", "A/H53", "B1/H24", "B2/H24R",
"B3/H24Rx", "B4/H24RxC", "B5/H24RxC")),
# 定义宿主顺序（按Total比例从高到低排序）
Host = factor(Host)
)
# 为了按Total比例排序宿主，先计算Total行
total_order <- heatmap_data %>%
filter(Type == "Total") %>%
arrange(desc(Percent)) %>%
pull(Host)
# 重新排序宿主因子
heatmap_data$Host <- factor(heatmap_data$Host, levels = total_order)
# 查看数据范围
cat("数据维度:", dim(heatmap_data), "\n")
cat("基因型:", levels(heatmap_data$Type), "\n")
cat("宿主数量:", length(levels(heatmap_data$Host)), "\n")
cat("百分比范围:", sprintf("%.2f%% 到 %.2f%%",
min(heatmap_data$Percent, na.rm = TRUE),
max(heatmap_data$Percent, na.rm = TRUE)), "\n\n")
# ==================== 3. 创建圆形热力图（颜色代表数值，点大小统一） ====================
p1 <- ggplot(heatmap_data, aes(x = Type, y = Host)) +
# 使用圆形，点大小统一，颜色编码百分比
geom_point(aes(color = Percent),
size = 9.5,  # 统一大小
shape = 19,
alpha = 0.85,
stroke = 0) +
# 只在圆形内部添加数值标签
geom_text(aes(label = ifelse(Percent >= 1,
sprintf("%.1f", Percent),
ifelse(Percent >= 0.1,
sprintf("%.1f", Percent),
ifelse(Percent > 0, "<0.1", "0.0")))),
color = "black",
size = 3.5) +
# 颜色渐变（viridis magma调色板）
scale_color_viridis(
option = "magma",
name = "(%)",
limits = c(0, 100),
direction = -1,  # 反向：高值亮色，低值暗色
begin = 0.1,     # 调整起始颜色
end = 0.95,      # 调整结束颜色
na.value = "gray85"
) +
# 主题设置
theme_minimal(base_size = 12) +
theme(
# 坐标轴文本
axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5, size = 11, color = "black"),
axis.text.y = element_text(size = 11, color = "black"),
# 移除坐标轴标题
axis.title = element_blank(),
# 网格线
panel.grid.major = element_line(color = "gray93", size = 0.3),
panel.grid.minor = element_blank(),
# 图例
legend.position = "right",
legend.key.height = unit(1.8, "cm"),
legend.key.width = unit(0.5, "cm"),
legend.title = element_text(face = "bold", size = 11, vjust = 0.8),
legend.text = element_text(size = 10, color = "black"),
# 标题
plot.title = element_text(face = "bold", size = 16, hjust = 0.5,
margin = margin(b = 15)),
plot.subtitle = element_text(size = 12, hjust = 0.5, color = "gray40",
margin = margin(b = 10)),
# 边距
plot.margin = margin(20, 20, 20, 20)
) +
# 标签
labs(
title = "Ecological distribution"
)
print(p1)
ggsave("heatmap_dots.pdf", p1, width = 9, height = 12, dpi = 300, bg = "white")
# ==================== 1. 加载包 ====================
required_packages <- c("tidyverse", "ggplot2", "viridis", "RColorBrewer", "scales")
new_packages <- required_packages[!required_packages %in% installed.packages()[,"Package"]]
if(length(new_packages)) install.packages(new_packages)
library(tidyverse)
library(ggplot2)
library(viridis)
library(RColorBrewer)
library(scales)
# ==================== 2. 数据准备 ====================
data <- read.csv("Heatmap_data.csv", stringsAsFactors = FALSE)
# 数据处理 - 保留Total
heatmap_data <- data %>%
mutate(
# 注意：你的Percentage列已经是百分比（0-100），不需要转换
Percent = Percentage,  # 直接使用原值
# 定义基因型顺序（Total在最前面）
Genotype = factor(Genotype,
levels = c("Total", "A/H53", "B1/H24", "B2/H24R",
"B3/H24Rx", "B4/H24RxC", "B5/H24RxC")),
# 定义宿主顺序（按Total比例从高到低排序）
Host = factor(Host)
)
# ==================== 1. 加载包 ====================
required_packages <- c("tidyverse", "ggplot2", "viridis", "RColorBrewer", "scales")
new_packages <- required_packages[!required_packages %in% installed.packages()[,"Package"]]
if(length(new_packages)) install.packages(new_packages)
library(tidyverse)
library(ggplot2)
library(viridis)
library(RColorBrewer)
library(scales)
# ==================== 2. 数据准备 ====================
data <- read.csv("Heatmap_data.csv", stringsAsFactors = FALSE)
# 数据处理 - 保留Total
heatmap_data <- data %>%
mutate(
# 注意：你的Percentage列已经是百分比（0-100），不需要转换
Percent = Percentage,  # 直接使用原值
# 定义基因型顺序（Total在最前面）
Type = factor(Type,
levels = c("Total", "A/H53", "B1/H24", "B2/H24R",
"B3/H24Rx", "B4/H24RxC", "B5/H24RxC")),
# 定义宿主顺序（按Total比例从高到低排序）
Host = factor(Host)
)
# 为了按Total比例排序宿主，先计算Total行
total_order <- heatmap_data %>%
filter(Type == "Total") %>%
arrange(desc(Percent)) %>%
pull(Host)
# 重新排序宿主因子
heatmap_data$Host <- factor(heatmap_data$Host, levels = total_order)
# 查看数据范围
cat("数据维度:", dim(heatmap_data), "\n")
cat("基因型:", levels(heatmap_data$Type), "\n")
cat("宿主数量:", length(levels(heatmap_data$Host)), "\n")
cat("百分比范围:", sprintf("%.2f%% 到 %.2f%%",
min(heatmap_data$Percent, na.rm = TRUE),
max(heatmap_data$Percent, na.rm = TRUE)), "\n\n")
# ==================== 3. 创建圆形热力图（颜色代表数值，点大小统一） ====================
p1 <- ggplot(heatmap_data, aes(x = Type, y = Host)) +
# 使用圆形，点大小统一，颜色编码百分比
geom_point(aes(color = Percent),
size = 9.5,  # 统一大小
shape = 19,
alpha = 0.85,
stroke = 0) +
# 只在圆形内部添加数值标签
geom_text(aes(label = ifelse(Percent >= 1,
sprintf("%.1f", Percent),
ifelse(Percent >= 0.1,
sprintf("%.1f", Percent),
ifelse(Percent > 0, "<0.1", "0.0")))),
color = "black",
size = 3.5) +
# 颜色渐变（viridis magma调色板）
scale_color_viridis(
option = "magma",
name = "(%)",
limits = c(0, 100),
direction = -1,  # 反向：高值亮色，低值暗色
begin = 0.1,     # 调整起始颜色
end = 0.95,      # 调整结束颜色
na.value = "gray85"
) +
# 主题设置
theme_minimal(base_size = 12) +
theme(
# 坐标轴文本
axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5, size = 11, color = "black"),
axis.text.y = element_text(size = 11, color = "black"),
# 移除坐标轴标题
axis.title = element_blank(),
# 网格线
panel.grid.major = element_line(color = "gray93", size = 0.3),
panel.grid.minor = element_blank(),
# 图例
legend.position = "right",
legend.key.height = unit(1.8, "cm"),
legend.key.width = unit(0.5, "cm"),
legend.title = element_text(size = 11, vjust = 0.8),
legend.text = element_text(size = 10, color = "black"),
# 标题
plot.title = element_text(face = "bold", size = 16, hjust = 0.5,
margin = margin(b = 15)),
plot.subtitle = element_text(size = 12, hjust = 0.5, color = "gray40",
margin = margin(b = 10)),
# 边距
plot.margin = margin(20, 20, 20, 20)
) +
# 标签
labs(
title = "Ecological distribution"
)
print(p1)
ggsave("heatmap_dots.pdf", p1, width = 9, height = 12, dpi = 300, bg = "white")
